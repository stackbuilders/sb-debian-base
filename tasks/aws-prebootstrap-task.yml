---
- name: Add OS user
  user:
    name=administrator comment="Privileged Administrator user" shell=/bin/bash
    uid={{ deploy_user_id + 1 }} group=sudo

- name: Enable default repos
  apt_repository: repo='deb http://ftp.debian.org/debian/ jessie main' state=present
  when: ansible_distribution == "Debian"

- name: Update packges
  apt: update_cache=yes

- name: Install sudo package
  apt: name={{ item }} state=present
  with_items:
    - sudo

- name: Sudo without password
  lineinfile: "dest=/etc/sudoers state=present regexp='^%sudo ALL' line='%sudo ALL=(ALL) NOPASSWD: ALL'"

- name: Set up authorized_keys for the administrator user
  authorized_key: user=administrator
                  key="{{ item }}"
  with_file:
    - keys/administrators
