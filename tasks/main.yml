---
- include: prebootstrap-tasks.yml
  remote_user: root
  tags:
    - prebootstrap

- include: bootstrap-tasks.yml
  remote_user: administrator
  become: yes
  become_method: sudo
  tags:
    - bootstrap


- name: Set up application deploy directory
  remote_user: administrator
  become: yes
  become_method: sudo
  file: 
    path=/var/projects state=directory
    owner="{{ user_owner_app_directory }}" group="{{ user_group_app_directory }}" mode=0775
  tags:
    - create-app-directory


- name: Install common Haskell build dependencies
  remote_user: administrator
  become: yes
  become_method: sudo
  apt: name={{ item }} state=present
  with_items:
    - libpcre3-dev
    - libsqlite3-dev
    - libpq-dev
  tags:
    - haskell-build-dependencies


- include: haskell-stack-tasks.yml
  remote_user: administrator
  become: yes
  become_method: sudo
  tags:
    - haskell-stack


- name: Install rvm dependencies
  remote_user: administrator
  become: yes
  become_method: sudo
  apt: name='{{ item }}' state=present
  with_items:
    - build-essential
    - tklib
    - zlib1g-dev
    - libssl-dev
    - libreadline-gplv2-dev
    - libxml2
    - libxml2-dev
    - libxslt1-dev
  tags:
    - ruby-dependencies
