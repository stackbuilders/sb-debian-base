---
- shell: "getent passwd | awk -F: '{print $1}'"
  register: current_users

- import_tasks: prebootstrap.yml
  remote_user: root
  when: prebootstrap is defined and sb_debian_base_admin_user not in current_users.stdout_lines

- import_tasks: bootstrap.yml
  remote_user: "{{ sb_debian_base_admin_user }}"
  become: yes
  when: bootstrap is defined

- import_tasks: haskell-dependencies.yml
  remote_user: "{{ sb_debian_base_admin_user }}"
  become: yes
  when: install_haskell_dependencies is defined

- import_tasks: haskell-stack.yml
  remote_user: "{{ sb_debian_base_admin_user }}"
  become: yes
  when: install_haskell_stack is defined

- import_tasks: set-authorized-keys.yml
  remote_user: "{{ sb_debian_base_admin_user }}"
  become: yes
  when: add_remove_keys is defined
  tags:
    - add-remove-keys
